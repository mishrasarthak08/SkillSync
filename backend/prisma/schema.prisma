generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model User {
  id            String    @id @default(auto()) @map("_id") @db.ObjectId
  name          String
  username      String?
  email         String    @unique
  password      String
  avatar        String?
  bio           String?
  createdAt     DateTime  @default(now())

  skills        UserSkill[]
  progress      LessonProgress[]
  badges        UserBadge[]

  xp            Int       @default(0)
  skillLevel    String?
  interests     String[]  @db.ObjectId
  interestDetails Interest[] @relation(fields: [interests], references: [id])
  roadmaps      UserRoadmap[]
}

model UserRoadmap {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  userId    String   @db.ObjectId
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  roadmap   Roadmap  @relation(fields: [roadmapId], references: [id])
  roadmapId String   @db.ObjectId
  status    String   @default("in_progress")
  startedAt DateTime @default(now())
  completedAt DateTime?

  @@unique([userId, roadmapId])
}

model Interest {
  id    String @id @default(auto()) @map("_id") @db.ObjectId
  name  String @unique
  users User[] @relation(fields: [userIds], references: [id])
  userIds String[] @db.ObjectId
}

model Skill {
  id          String        @id @default(auto()) @map("_id") @db.ObjectId
  name        String
  description String
  category    String
  difficulty  String
  image       String?
  creatorId   String?       @db.ObjectId

  modules      Module[]
  users        UserSkill[]
  roadmaps     RoadmapSkill[]
  createdAt    DateTime      @default(now())
}


model Module {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  skill     Skill    @relation(fields: [skillId], references: [id])
  skillId   String   @db.ObjectId

  title     String
  order     Int
  lessons   Lesson[]
}

model Lesson {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  module      Module   @relation(fields: [moduleId], references: [id])
  moduleId    String   @db.ObjectId

  title       String
  content     String
  videoUrl    String?
  order       Int
  difficulty  String

  progress    LessonProgress[]
}


model UserSkill {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  userId    String   @db.ObjectId
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  skill     Skill    @relation(fields: [skillId], references: [id])
  skillId   String   @db.ObjectId

  status    String
  startedAt DateTime @default(now())
  updatedAt DateTime @default(now())
  completedAt DateTime?

  @@unique([userId, skillId])
}


model LessonProgress {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  userId    String   @db.ObjectId
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  lesson    Lesson   @relation(fields: [lessonId], references: [id])
  lessonId  String   @db.ObjectId

  completed Boolean  @default(false)
  completedAt DateTime?

  @@unique([userId, lessonId])
}

model Roadmap {
  id        String          @id @default(auto()) @map("_id") @db.ObjectId
  title     String
  description String
  estimatedTime String
  skills    RoadmapSkill[]
  users     UserRoadmap[]
  createdAt DateTime        @default(now())
}

model RoadmapSkill {
  id        String     @id @default(auto()) @map("_id") @db.ObjectId
  roadmap   Roadmap    @relation(fields: [roadmapId], references: [id])
  roadmapId String     @db.ObjectId

  skill     Skill      @relation(fields: [skillId], references: [id])
  skillId   String     @db.ObjectId

  order     Int
}

model Badge {
  id        String    @id @default(auto()) @map("_id") @db.ObjectId
  title     String
  icon      String
  description String
  users     UserBadge[]
}

model UserBadge {
  id       String  @id @default(auto()) @map("_id") @db.ObjectId
  userId   String  @db.ObjectId
  user     User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  badge    Badge   @relation(fields: [badgeId], references: [id])
  badgeId  String  @db.ObjectId

  awardedAt DateTime @default(now())

  @@unique([userId, badgeId])
}
